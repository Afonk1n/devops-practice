## Docker — базовая шпаргалка (на примере `simple-nginx`)

Мы будем использовать мини-проект `simple-nginx`:

- директория: `/mnt/d/DevOpsPractice/simple-nginx`
- файлы:
  - `Dockerfile`
  - `index.html`

### 1. Проверка Docker и переход к проекту

```bash
docker --version
```
- показывает версию клиента Docker, важно убедиться, что Docker установлен и демон запущен.

Если видишь ошибку вида:

```text
permission denied while trying to connect to the Docker daemon socket at unix:///var/run/docker.sock
```

— это значит, что текущему пользователю не хватает прав, чтобы обращаться к Docker-демону.  
Простейший вариант для учебных задач — вызывать команды через `sudo`:

```bash
sudo docker build ...
sudo docker run ...
```

В бою обычно добавляют пользователя в группу `docker`, но для быстрого старта достаточно `sudo`.

```bash
cd /mnt/d/DevOpsPractice/simple-nginx
ls
```
- `cd` — переходим в каталог проекта.
- `ls` — проверяем, что видим `Dockerfile`, `index.html`, `README.md`.

### 2. `Dockerfile` — разбор построчно

Содержимое файла:

```dockerfile
FROM nginx:alpine

# Кладём нашу страницу вместо стандартной
COPY index.html /usr/share/nginx/html/index.html

EXPOSE 80
```

Разбор:

- **`FROM nginx:alpine`**
  - базовый образ — официальный Nginx на базе лёгкого дистрибутива Alpine Linux;
  - каждая инструкция в Dockerfile создаёт новый слой поверх базового образа.

- **`COPY index.html /usr/share/nginx/html/index.html`**
  - копируем наш локальный файл `index.html` внутрь образа;
  - путь назначения `/usr/share/nginx/html/index.html` — дефолтная директория, откуда Nginx раздаёт статические файлы;
  - этим мы **заменяем стандартную стартовую страницу** Nginx своей.

- **`EXPOSE 80`**
  - декларация: контейнер «слушает» порт `80`;
  - это **не проброс порта на хост**, а просто подсказка/документация для людей и некоторых инструментов;
  - реальный проброс делается при запуске (`-p 8080:80`).

### 3. Сборка образа

```bash
docker build -t devops-nginx .
```

Разбор:
- **`docker build`** — команда сборки образа из Dockerfile.
- **`-t devops-nginx`** — tag, даём имя образу `devops-nginx` (можно потом использовать при запуске).
- **`.`** — контекст сборки: текущая директория; всё её содержимое доступно Docker-демону (например, чтобы `COPY index.html` работало).

Что происходит во время сборки:
- Docker читает `Dockerfile`;
- скачивает базовый образ `nginx:alpine` (если его нет локально);
- применяет инструкции (`COPY` и т.д.), создавая новый image;
- в конце выводит что-то вроде: `Successfully tagged devops-nginx:latest`.

Посмотреть список образов:

```bash
docker images
```

- показывает локальные образы: REPOSITORY, TAG, IMAGE ID, SIZE.

### 4. Запуск контейнера

```bash
docker run --rm -p 8080:80 devops-nginx
```

Разбор флагов:
- **`docker run`** — создать и запустить контейнер из образа.
- **`--rm`** — после остановки контейнера Docker автоматически его удалит (не будет «мусора» из остановленных контейнеров).
- **`-p 8080:80`** — проброс портов: `host:container`:
  - `8080` — порт на хосте (Windows/WSL, куда ты заходишь через браузер);
  - `80` — порт внутри контейнера, который слушает Nginx;
  - в итоге `http://localhost:8080` → контейнер:`80`.
- **`devops-nginx`** — имя образа, из которого создаётся контейнер.

Пока контейнер запущен:
- можно открыть в браузере `http://localhost:8080` и увидеть страницу из `index.html`;
- в терминале будет видно логи Nginx (если будут запросы/ошибки).

Остановить контейнер:
- нажать `Ctrl + C` в том терминале, где запущен `docker run`.

### 5. Основные понятия, которые важно уметь произнести

- **Image (образ)**:
  - шаблон файловой системы + метаданные;
  - как «класс»/шаблон, из которого создаются контейнеры;
  - неизменяемый (immutable).

- **Container (контейнер)**:
  - запущенный экземпляр образа;
  - как «объект» на основе класса: свой PID, свои процессы, своё файловое пространство (но поверх слоёв образа).

- **Слои образа**:
  - каждая инструкция Dockerfile (`FROM`, `COPY`, `RUN` и т.д.) создаёт слой;
  - слои кешируются: при повторной сборке Docker использует кеш и не пересобирает то, что не изменилось.

### 6. Примеры фраз для собеса (по Docker)

- «Работал с Docker на базовом уровне: умел читать и писать простые Dockerfile, собирал образы и запускал контейнеры.»
- «Понимаю разницу между образом и контейнером: образ — это шаблон, контейнер — запущенный экземпляр с изолированным окружением.»
- «Собирал простой образ с Nginx на `nginx:alpine`, заменял дефолтную страницу своим `index.html`, запускал через `docker run -p 8080:80 ...` и проверял в браузере.»
- «Знаю базовые флаги `docker run`: `-p` для проброса портов, `--rm` чтобы контейнер удалялся после остановки.»


